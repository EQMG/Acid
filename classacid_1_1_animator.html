<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>acid::Animator class | Acid A
high
speed
C++17
Vulkan
game
engine</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600" />
  <link rel="stylesheet" href="m-dark+documentation.compiled.css" />
  <link rel="stylesheet" href="acid.css" />
  <link rel="icon" href="favicon.ico" type="image/vnd.microsoft.icon" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#22272e" />
  <meta
  name="google-site-verification"
  content="CFh8H_6dbXMEBgSBApTt5U8Tq5CO3iL3dCIhww9DiYs"
  />
  <meta
  name="description"
  content="A
  high
  speed
  C++17
  Vulkan
  game
  engine.">
  <script
  src="acid.js"></script>
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <a href="index.html" id="m-navbar-brand" class="m-col-t-8 m-col-m-none m-left-m"><img src="Acid_01.png" alt="" />Acid <span class="m-thin">A
high
speed
C++17
Vulkan
game
engine</span></a>
      <div class="m-col-t-4 m-hide-m m-text-right m-nopadr">
        <a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
          <path id="m-doc-search-icon-path" d="m6 0c-3.31 0-6 2.69-6 6 0 3.31 2.69 6 6 6 1.49 0 2.85-0.541 3.89-1.44-0.0164 0.338 0.147 0.759 0.5 1.15l3.22 3.79c0.552 0.614 1.45 0.665 2 0.115 0.55-0.55 0.499-1.45-0.115-2l-3.79-3.22c-0.392-0.353-0.812-0.515-1.15-0.5 0.895-1.05 1.44-2.41 1.44-3.89 0-3.31-2.69-6-6-6zm0 1.56a4.44 4.44 0 0 1 4.44 4.44 4.44 4.44 0 0 1-4.44 4.44 4.44 4.44 0 0 1-4.44-4.44 4.44 4.44 0 0 1 4.44-4.44z"/>
        </svg></a>
        <a id="m-navbar-show" href="#navigation" title="Show navigation"></a>
        <a id="m-navbar-hide" href="#" title="Hide navigation"></a>
      </div>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-6 m-col-m-none">
            <li><a href="namespaces.html">Namespaces</a></li>
          </ol>
          <ol class="m-col-t-6 m-col-m-none" start="2">
            <li><a href="annotated.html">Classes</a></li>
            <li><a target="_blank" href="https://github.com/EQMG/Acid/" class="github">Github</a></li>
            <li class="m-show-m"><a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
              <use href="#m-doc-search-icon-path" />
            </svg></a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main><article>
  <div class="m-container m-container-inflatable">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <h1>
          <span class="m-breadcrumb"><a href="namespaceacid.html">acid</a>::<wbr/></span>Animator <span class="m-thin">class</span>
        </h1>
        <p>Class that contains all the functionality to apply an animation to an animated entity. An <a href="classacid_1_1_animator.html" class="m-doc">Animator</a> instance is associated with just one animated entity. It also keeps track of the running time (in seconds) of the current animation, along with a reference to the currently playing animation for the corresponding entity.</p>
        <nav class="m-block m-default">
          <h3>Contents</h3>
          <ul>
            <li>
              Reference
              <ul>
                <li><a href="#pub-static-methods">Public static functions</a></li>
                <li><a href="#pub-methods">Public functions</a></li>
              </ul>
            </li>
          </ul>
        </nav>
<p>An <a href="classacid_1_1_animator.html" class="m-doc">Animator</a> instance needs to be updated every frame, in order for it to keep updating the animation pose of the associated entity. The currently playing animation can be changed at any time using <a href="classacid_1_1_animator.html#a4c88f3b887a50de7f2d0cca11ec44fc3" class="m-doc">Animator#DoAnimation</a>. The <a href="classacid_1_1_animator.html" class="m-doc">Animator</a> will keep looping the current animation until a new animation is chosen. The <a href="classacid_1_1_animator.html" class="m-doc">Animator</a> calculates the desired current animation pose by interpolating between the previous and next keyframes of the animation (based on the current animation time). The <a href="classacid_1_1_animator.html" class="m-doc">Animator</a> then updates the transforms all of the joints each frame to match the current desired animation pose.</p>
        <section id="pub-static-methods">
          <h2><a href="#pub-static-methods">Public static functions</a></h2>
          <dl class="m-doc">
            <dt>
              <span class="m-doc-wrap-bumper">static void <a href="#a59dbd93c8620d3e443f2ff9315e21e05" class="m-doc">CalculateJointPose</a>(</span><span class="m-doc-wrap">const std::map&lt;std::string, <a href="classacid_1_1_matrix4.html" class="m-doc">Matrix4</a>&gt;&amp; currentPose,
              const <a href="classacid_1_1_joint.html" class="m-doc">Joint</a>&amp; joint,
              const <a href="classacid_1_1_matrix4.html" class="m-doc">Matrix4</a>&amp; parentTransform,
              std::vector&lt;<a href="classacid_1_1_matrix4.html" class="m-doc">Matrix4</a>&gt;&amp; jointMatrices)</span>
            </dt>
            <dd></dd>
          </dl>
        </section>
        <section id="pub-methods">
          <h2><a href="#pub-methods">Public functions</a></h2>
          <dl class="m-doc">
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#abbc2d4350569934ca2c0ac763c594c62" class="m-doc">Update</a>(</span><span class="m-doc-wrap">const <a href="classacid_1_1_joint.html" class="m-doc">Joint</a>&amp; rootJoint,
              std::vector&lt;<a href="classacid_1_1_matrix4.html" class="m-doc">Matrix4</a>&gt;&amp; jointMatrices)</span>
            </dt>
            <dd></dd>
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#ad735fe5d6ef1d389935efa8fd133a938" class="m-doc">IncreaseAnimationTime</a>(</span><span class="m-doc-wrap">)</span>
            </dt>
            <dd></dd>
            <dt>
              <span class="m-doc-wrap-bumper">auto <a href="#a30eb40654e82a863fd9e1d1dd7581209" class="m-doc">CalculateCurrentAnimationPose</a>(</span><span class="m-doc-wrap">) const -&gt; std::map&lt;std::string, <a href="classacid_1_1_matrix4.html" class="m-doc">Matrix4</a>&gt;</span>
            </dt>
            <dd></dd>
            <dt>
              <span class="m-doc-wrap-bumper">auto <a href="#ac429fb586973614a3b64f6f91a3740d2" class="m-doc">GetPreviousAndNextFrames</a>(</span><span class="m-doc-wrap">) const -&gt; std::pair&lt;<a href="classacid_1_1_keyframe.html" class="m-doc">Keyframe</a>, <a href="classacid_1_1_keyframe.html" class="m-doc">Keyframe</a>&gt;</span>
            </dt>
            <dd></dd>
            <dt>
              <span class="m-doc-wrap-bumper">auto <a href="#a62d8a6e37c6dcb8299a08d27ef4e111c" class="m-doc">CalculateProgression</a>(</span><span class="m-doc-wrap">const <a href="classacid_1_1_keyframe.html" class="m-doc">Keyframe</a>&amp; previousFrame,
              const <a href="classacid_1_1_keyframe.html" class="m-doc">Keyframe</a>&amp; nextFrame) const -&gt; float</span>
            </dt>
            <dd></dd>
            <dt>
              <span class="m-doc-wrap-bumper">auto <a href="#a1cfcdbe50743e9a813f428dbb1c3e906" class="m-doc">InterpolatePoses</a>(</span><span class="m-doc-wrap">const <a href="classacid_1_1_keyframe.html" class="m-doc">Keyframe</a>&amp; previousFrame,
              const <a href="classacid_1_1_keyframe.html" class="m-doc">Keyframe</a>&amp; nextFrame,
              float progression) const -&gt; std::map&lt;std::string, <a href="classacid_1_1_matrix4.html" class="m-doc">Matrix4</a>&gt;</span>
            </dt>
            <dd></dd>
            <dt id="acc81860d4612eb50690a6c91409b9f43">
              <span class="m-doc-wrap-bumper">auto <a href="#acc81860d4612eb50690a6c91409b9f43" class="m-doc-self">GetCurrentAnimation</a>(</span><span class="m-doc-wrap">) const -&gt; const <a href="classacid_1_1_animation.html" class="m-doc">Animation</a>*</span>
            </dt>
            <dd><span></span></dd>
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#a4c88f3b887a50de7f2d0cca11ec44fc3" class="m-doc">DoAnimation</a>(</span><span class="m-doc-wrap"><a href="classacid_1_1_animation.html" class="m-doc">Animation</a>* animation)</span>
            </dt>
            <dd></dd>
          </dl>
        </section>
        <section>
          <h2>Function documentation</h2>
          <section class="m-doc-details" id="a59dbd93c8620d3e443f2ff9315e21e05"><div>
            <h3>
              <span class="m-doc-wrap-bumper">static void acid::<wbr />Animator::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a59dbd93c8620d3e443f2ff9315e21e05" class="m-doc-self">CalculateJointPose</a>(</span><span class="m-doc-wrap">const std::map&lt;std::string, <a href="classacid_1_1_matrix4.html" class="m-doc">Matrix4</a>&gt;&amp; currentPose,
              const <a href="classacid_1_1_joint.html" class="m-doc">Joint</a>&amp; joint,
              const <a href="classacid_1_1_matrix4.html" class="m-doc">Matrix4</a>&amp; parentTransform,
              std::vector&lt;<a href="classacid_1_1_matrix4.html" class="m-doc">Matrix4</a>&gt;&amp; jointMatrices)</span></span>
            </h3>
            <table class="m-table m-fullwidth m-flat">
              <thead>
                <tr><th colspan="2">Parameters</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td style="width: 1%">currentPose</td>
                  <td>A map of the local-space transforms for all the joints for the desired pose. The map is indexed by the name of the joint which the transform corresponds to.</td>
                </tr>
                <tr>
                  <td>joint</td>
                  <td>The current joint which the pose should be applied to.</td>
                </tr>
                <tr>
                  <td>parentTransform</td>
                  <td>The desired model-space transform of the parent joint for the pose.</td>
                </tr>
                <tr>
                  <td>jointMatrices</td>
                  <td>The transforms that get loaded up to the shader and is used to deform the vertices of the &quot;skin&quot;.</td>
                </tr>
              </tbody>
            </table>
<p>This method applies the current pose to a given joint, and all of its descendants. It does this by getting the desired local-transform for the current joint, before applying it to the joint. Before applying the transformations it needs to be converted from local-space to model-space (so that they are relative to the model&#x27;s origin, rather than relative to the parent joint). This can be done by multiplying the local-transform of the joint with the model-space transform of the parent joint.</p><p>The same thing is then done to all the child joints.</p><p>Finally the inverse of the joint&#x27;s bind transform is multiplied with the model-space transform of the joint. This basically &quot;subtracts&quot; the joint&#x27;s original bind (no animation applied) transform from the desired pose transform. The result of this is then the transform required to move the joint from its original model-space transform to it&#x27;s desired model-space posed transform. This is the transform that needs to be loaded up to the vertex shader and used to transform the vertices into the current pose.</p>
          </div></section>
          <section class="m-doc-details" id="abbc2d4350569934ca2c0ac763c594c62"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void acid::<wbr />Animator::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#abbc2d4350569934ca2c0ac763c594c62" class="m-doc-self">Update</a>(</span><span class="m-doc-wrap">const <a href="classacid_1_1_joint.html" class="m-doc">Joint</a>&amp; rootJoint,
              std::vector&lt;<a href="classacid_1_1_matrix4.html" class="m-doc">Matrix4</a>&gt;&amp; jointMatrices)</span></span>
            </h3>
            <table class="m-table m-fullwidth m-flat">
              <thead>
                <tr><th colspan="2">Parameters</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td style="width: 1%">rootJoint</td>
                  <td>The root joint of the joint hierarchy which makes up the &quot;skeleton&quot; of the entity.</td>
                </tr>
                <tr>
                  <td>jointMatrices</td>
                  <td>The transforms that get loaded up to the shader and is used to deform the vertices of the &quot;skin&quot;.</td>
                </tr>
              </tbody>
            </table>
<p>This method should be called each frame to update the animation currently being played. This increases the animation time (and loops it back to zero if necessary), finds the pose that the entity should be in at that time of the animation, and then applied that pose to all the entity&#x27;s joints.</p>
          </div></section>
          <section class="m-doc-details" id="ad735fe5d6ef1d389935efa8fd133a938"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void acid::<wbr />Animator::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#ad735fe5d6ef1d389935efa8fd133a938" class="m-doc-self">IncreaseAnimationTime</a>(</span><span class="m-doc-wrap">)</span></span>
            </h3>
<p>Increases the current animation time which allows the animation to progress. If the current animation has reached the end then the timer is reset, causing the animation to loop.</p>
          </div></section>
          <section class="m-doc-details" id="a30eb40654e82a863fd9e1d1dd7581209"><div>
            <h3>
              <span class="m-doc-wrap-bumper">std::map&lt;std::string, <a href="classacid_1_1_matrix4.html" class="m-doc">Matrix4</a>&gt; acid::<wbr />Animator::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a30eb40654e82a863fd9e1d1dd7581209" class="m-doc-self">CalculateCurrentAnimationPose</a>(</span><span class="m-doc-wrap">) const</span></span>
            </h3>
            <table class="m-table m-fullwidth m-flat">
              <tfoot>
                <tr>
                  <th style="width: 1%">Returns</th>
                  <td>The current pose as a map of the desired local-space transforms for all the joints. The transforms are indexed by the name ID of the joint that they should be applied to.</td>
                </tr>
              </tfoot>
            </table>
<p>This method returns the current animation pose of the entity. It returns the desired local-space transforms for all the joints in a map, indexed by the name of the joint that they correspond to.</p><p>The pose is calculated based on the previous and next keyframes in the current animation. Each keyframe provides the desired pose at a certain time in the animation, so the animated pose for the current time can be calculated by interpolating between the previous and next keyframe.</p><p>This method first finds the previous and next keyframe, calculates how far between the two the current animation is, and then calculated the pose for the current animation time by interpolating between the transforms at those keyframes.</p>
          </div></section>
          <section class="m-doc-details" id="ac429fb586973614a3b64f6f91a3740d2"><div>
            <h3>
              <span class="m-doc-wrap-bumper">std::pair&lt;<a href="classacid_1_1_keyframe.html" class="m-doc">Keyframe</a>, <a href="classacid_1_1_keyframe.html" class="m-doc">Keyframe</a>&gt; acid::<wbr />Animator::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#ac429fb586973614a3b64f6f91a3740d2" class="m-doc-self">GetPreviousAndNextFrames</a>(</span><span class="m-doc-wrap">) const</span></span>
            </h3>
            <table class="m-table m-fullwidth m-flat">
              <tfoot>
                <tr>
                  <th style="width: 1%">Returns</th>
                  <td>The previous and next keyframes, in an array which therefore will always have a length of 2.</td>
                </tr>
              </tfoot>
            </table>
<p>Finds the previous keyframe in the animation and the next keyframe in the animation, and returns them in an array of length 2. If there is no previous frame (perhaps current animation time is 0.5 and the first keyframe is at time 1.5) then the next keyframe is used as both the previous and next keyframe. The reverse happens if there is no next keyframe.</p>
          </div></section>
          <section class="m-doc-details" id="a62d8a6e37c6dcb8299a08d27ef4e111c"><div>
            <h3>
              <span class="m-doc-wrap-bumper">float acid::<wbr />Animator::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a62d8a6e37c6dcb8299a08d27ef4e111c" class="m-doc-self">CalculateProgression</a>(</span><span class="m-doc-wrap">const <a href="classacid_1_1_keyframe.html" class="m-doc">Keyframe</a>&amp; previousFrame,
              const <a href="classacid_1_1_keyframe.html" class="m-doc">Keyframe</a>&amp; nextFrame) const</span></span>
            </h3>
            <table class="m-table m-fullwidth m-flat">
              <thead>
                <tr><th colspan="2">Parameters</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td style="width: 1%">previousFrame</td>
                  <td>The previous keyframe in the animation.</td>
                </tr>
                <tr>
                  <td>nextFrame</td>
                  <td>The next keyframe in the animation.</td>
                </tr>
              </tbody>
              <tfoot>
                <tr>
                  <th>Returns</th>
                  <td>A number between 0 and 1 indicating how far between the two keyframes the current animation time is.</td>
                </tr>
              </tfoot>
            </table>
<p>Calculates how far between the previous and next keyframe the current animation time is, and returns it as a value between 0 and 1.</p>
          </div></section>
          <section class="m-doc-details" id="a1cfcdbe50743e9a813f428dbb1c3e906"><div>
            <h3>
              <span class="m-doc-wrap-bumper">std::map&lt;std::string, <a href="classacid_1_1_matrix4.html" class="m-doc">Matrix4</a>&gt; acid::<wbr />Animator::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a1cfcdbe50743e9a813f428dbb1c3e906" class="m-doc-self">InterpolatePoses</a>(</span><span class="m-doc-wrap">const <a href="classacid_1_1_keyframe.html" class="m-doc">Keyframe</a>&amp; previousFrame,
              const <a href="classacid_1_1_keyframe.html" class="m-doc">Keyframe</a>&amp; nextFrame,
              float progression) const</span></span>
            </h3>
            <table class="m-table m-fullwidth m-flat">
              <thead>
                <tr><th colspan="2">Parameters</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td style="width: 1%">previousFrame</td>
                  <td>The previous keyframe in the animation.</td>
                </tr>
                <tr>
                  <td>nextFrame</td>
                  <td>The next keyframe in the animation.</td>
                </tr>
                <tr>
                  <td>progression</td>
                  <td>A number between 0 and 1 indicating how far between the previous and next keyframes the current animation time is.</td>
                </tr>
              </tbody>
              <tfoot>
                <tr>
                  <th>Returns</th>
                  <td>The local-space transforms for all the joints for the desired current pose. They are returned in a map, indexed by the name of the joint to which they should be applied.</td>
                </tr>
              </tfoot>
            </table>
<p>Calculates all the local-space joint transforms for the desired current pose by interpolating between the transforms at the previous and next keyframes.</p>
          </div></section>
          <section class="m-doc-details" id="a4c88f3b887a50de7f2d0cca11ec44fc3"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void acid::<wbr />Animator::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a4c88f3b887a50de7f2d0cca11ec44fc3" class="m-doc-self">DoAnimation</a>(</span><span class="m-doc-wrap"><a href="classacid_1_1_animation.html" class="m-doc">Animation</a>* animation)</span></span>
            </h3>
            <table class="m-table m-fullwidth m-flat">
              <thead>
                <tr><th colspan="2">Parameters</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td style="width: 1%">animation</td>
                  <td>The new animation to carry out.</td>
                </tr>
              </tbody>
            </table>
<p>Indicates that the entity should carry out the given animation. Resets the animation time so that the new animation starts from the beginning.</p>
          </div></section>
        </section>
      </div>
    </div>
  </div>
</article></main>
<div class="m-doc-search" id="search">
  <a href="#!" onclick="return hideSearch()"></a>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-m-8 m-push-m-2">
        <div class="m-doc-search-header m-text m-small">
          <div><span class="m-label m-default">Tab</span> / <span class="m-label m-default">T</span> to search, <span class="m-label m-default">Esc</span> to close</div>
          <div id="search-symbolcount">&hellip;</div>
        </div>
        <div class="m-doc-search-content">
          <form>
            <input type="search" name="q" id="search-input" placeholder="Loading &hellip;" disabled="disabled" autofocus="autofocus" autocomplete="off" spellcheck="false" />
          </form>
          <noscript class="m-text m-danger m-text-center">Unlike everything else in the docs, the search functionality <em>requires</em> JavaScript.</noscript>
          <div id="search-help" class="m-text m-dim m-text-center">
            <p class="m-noindent">Search for symbols, directories, files, pages or
            modules. You can omit any prefix from the symbol or file path; adding a
            <code>:</code> or <code>/</code> suffix lists all members of given symbol or
            directory.</p>
            <p class="m-noindent">Use <span class="m-label m-dim">&darr;</span>
            / <span class="m-label m-dim">&uarr;</span> to navigate through the list,
            <span class="m-label m-dim">Enter</span> to go.
            <span class="m-label m-dim">Tab</span> autocompletes common prefix, you can
            copy a link to the result using <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">L</span> while <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">M</span> produces a Markdown link.</p>
          </div>
          <div id="search-notfound" class="m-text m-warning m-text-center">Sorry, nothing was found.</div>
          <ul id="search-results"></ul>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="search-v2.js"></script>
<script src="searchdata-v2.js" async="async"></script>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <a
target="_blank"
href="https://github.com/EQMG/Acid/">Github</a>
&bull;

<a
target="_blank"
href="https://github.com/EQMG/Acid/issues">Report
an
issue</a>

<br><br>Documentation
generated
using
<a
href="https://mcss.mosra.cz/">m.css</a>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>
